(function(){"use strict";let c=null;const a=n=>typeof n=="number"?n:0,p=n=>({x0:a(n?.x0),y0:a(n?.y0),x1:a(n?.x1),y1:a(n?.y1)}),u=n=>{const o=typeof n.text=="string"?n.text:"",i=(Array.isArray(n.words)?n.words:[]).map((t,e)=>{const s=t??{},f=s.line??{},I=f.paragraph??{},m=String(f.id??`line-${e}`),h=String(I.id??`block-${e}`),l=p(s.bbox??{});return{text:String(s.text??"").trim(),...l,confidence:a(s.confidence),lineId:m,blockId:h}}).filter(t=>t.text.length>0),x=new Map;i.forEach((t,e)=>{const s=x.get(t.lineId);if(s){s.text.push(t.text),s.x0=Math.min(s.x0,t.x0),s.y0=Math.min(s.y0,t.y0),s.x1=Math.max(s.x1,t.x1),s.y1=Math.max(s.y1,t.y1),s.confTotal+=t.confidence,s.count+=1,s.wordIds.push(e);return}x.set(t.lineId,{id:t.lineId,blockId:t.blockId,text:[t.text],x0:t.x0,y0:t.y0,x1:t.x1,y1:t.y1,confTotal:t.confidence,count:1,wordIds:[e]})});const d=Array.from(x.values()).map(t=>({id:t.id,blockId:t.blockId,text:t.text.join(" "),x0:t.x0,y0:t.y0,x1:t.x1,y1:t.y1,confidence:t.count?t.confTotal/t.count:0,wordIds:t.wordIds})),y=new Map;d.forEach(t=>{const e=y.get(t.blockId);if(e){e.text.push(t.text),e.x0=Math.min(e.x0,t.x0),e.y0=Math.min(e.y0,t.y0),e.x1=Math.max(e.x1,t.x1),e.y1=Math.max(e.y1,t.y1),e.confTotal+=t.confidence,e.count+=1,e.lineIds.push(t.id);return}y.set(t.blockId,{id:t.blockId,text:[t.text],x0:t.x0,y0:t.y0,x1:t.x1,y1:t.y1,confTotal:t.confidence,count:1,lineIds:[t.id]})});const g=Array.from(y.values()).map(t=>({id:t.id,text:t.text.join(`
`),x0:t.x0,y0:t.y0,x1:t.x1,y1:t.y1,confidence:t.count?t.confTotal/t.count:0,lineIds:t.lineIds}));return{rawText:o,words:i,lines:d,blocks:g}};self.onmessage=async n=>{const o=n.data;try{if(o.type==="init"){"Tesseract"in self||importScripts("https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"),c=await Tesseract.createWorker(o.language,1,{logger:r=>{r.status==="recognizing text"&&self.postMessage({type:"progress",progress:a(r.progress)})}}),self.postMessage({type:"ready"});return}if(o.type==="recognize"){if(!c){self.postMessage({type:"error",taskId:o.taskId,error:"OCR worker n√£o inicializado"});return}const{data:r}=await c.recognize(o.image),i=u(r);self.postMessage({type:"result",taskId:o.taskId,result:i});return}o.type==="terminate"&&(c&&await c.terminate(),c=null)}catch(r){self.postMessage({type:"error",taskId:o.type==="recognize"?o.taskId:void 0,error:r instanceof Error?r.message:"Falha desconhecida no OCR"})}}})();
